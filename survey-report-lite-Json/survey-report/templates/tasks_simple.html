<!DOCTYPE html>
<html>
<head>
    <title>–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            min-height: 100vh;
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .nav-link {
            color: #2c3e50 !important;
            font-weight: 600;
            padding: 12px 20px !important;
            border-radius: 8px;
            margin: 0 5px;
            transition: all 0.3s;
        }
        
        .nav-link.active {
            background: #f39c12;
            color: white !important;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }
        
        .header-card {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .table-custom {
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .table-custom thead th {
            background: #2c3e50;
            color: white;
        }
        
        .progress-custom {
            height: 20px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/" style="font-weight: 800; font-size: 1.5rem;">
                <i class="fas fa-chart-network text-primary"></i> IT –û—Ç—á–µ—Ç –ø–æ –æ–ø—Ä–æ—Å—É
            </a>
            <div class="navbar-nav">
                <a class="nav-link" href="/locations">üìç –õ–æ–∫–∞—Ü–∏–∏</a>
                <a class="nav-link" href="/questions">‚ùì –í–æ–ø—Ä–æ—Å—ã</a>
                <a class="nav-link active" href="/tasks">‚úÖ –ó–∞–¥–∞—á–∏</a>
                <a class="nav-link" href="/import">üì• –ò–º–ø–æ—Ä—Ç</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="main-container">
            <div class="header-card">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="display-4 mb-3">
                            <i class="fas fa-tasks"></i> ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
                        </h1>
                        <p class="lead mb-0">–ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö –∏ —É–ª—É—á—à–µ–Ω–∏—è—Ö</p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="bg-white text-dark rounded-pill px-4 py-3 d-inline-block shadow">
                            <small class="text-muted d-block">–û–±–Ω–æ–≤–ª–µ–Ω–æ</small>
                            <strong class="fs-5">{{ now_time }}</strong>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="alert alert-success">
                <h4 class="alert-heading">
                    <i class="fas fa-trophy"></i> –í—Å–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: {{ completed_tasks }} –∏–∑ {{ total_tasks }} –∑–∞–¥–∞—á
                </h4>
                <p class="mb-0">–ù–∞ –æ—Å–Ω–æ–≤–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –∏–∑ –æ–ø—Ä–æ—Å–∞ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏</p>
                {% set completion_rate = (completed_tasks/total_tasks*100)|round(1) if total_tasks > 0 else 0 %}
                <div class="progress progress-custom mt-3">
                    <div class="progress-bar bg-success" style="width: {{ completion_rate }}%"></div>
                </div>
                <div class="text-center mt-2">
                    <strong>{{ completion_rate }}% –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</strong>
                </div>
            </div>
            
            <div class="table-responsive">
                <table class="table table-striped table-hover table-custom">
                    <thead class="table-dark">
                        <tr>
                            <th>–ö–ª—é—á –∑–∞–¥–∞—á–∏</th>
                            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th>–õ–æ–∫–∞—Ü–∏—è</th>
                            <th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for task in tasks %}
                        <tr>
                            <td><strong>{{ task.task_key }}</strong></td>
                            <td>{{ task.summary }}</td>
                            <td>
                                {% if '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' in task.status %}
                                <span class="badge bg-success">‚úÖ {{ task.status }}</span>
                                {% elif '–í —Ä–∞–±–æ—Ç–µ' in task.status %}
                                <span class="badge bg-warning">üîÑ {{ task.status }}</span>
                                {% else %}
                                <span class="badge bg-secondary">{{ task.status }}</span>
                                {% endif %}
                            </td>
                            <td>
                                <span class="badge 
                                    {% if task.category == '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ü–û' %}bg-primary
                                    {% elif task.category == '–ù–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã' %}bg-success
                                    {% elif task.category == '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å' %}bg-danger
                                    {% elif task.category == '–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞' %}bg-warning
                                    {% else %}bg-secondary{% endif %}">
                                    {{ task.category }}
                                </span>
                            </td>
                            <td>{{ task.location }}</td>
                            <td>
                                {% if task.priority == 1 %}
                                <span class="badge bg-danger">–í—ã—Å–æ–∫–∏–π</span>
                                {% elif task.priority == 2 %}
                                <span class="badge bg-warning">–°—Ä–µ–¥–Ω–∏–π</span>
                                {% else %}
                                <span class="badge bg-secondary">–ù–∏–∑–∫–∏–π</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <div class="row mt-4">
                <div class="col-md-4">
                    <div class="metric-card text-center">
                        <h2 class="text-success">{{ completed_tasks }}</h2>
                        <p class="text-muted">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="metric-card text-center">
                        {% set in_progress = tasks|selectattr('status', 'equalto', '–í —Ä–∞–±–æ—Ç–µ')|list|length %}
                        <h2 class="text-primary">{{ in_progress }}</h2>
                        <p class="text-muted">–í —Ä–∞–±–æ—Ç–µ</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="metric-card text-center">
                        {% set planned = tasks|selectattr('status', 'equalto', '–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ')|list|length %}
                        <h2 class="text-warning">{{ planned }}</h2>
                        <p class="text-muted">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ</p>
                    </div>
                </div>
            </div>
            
            <div class="mt-4 text-center">
                <a href="/locations" class="btn btn-primary me-2">
                    <i class="fas fa-map-marked-alt"></i> –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ª–æ–∫–∞—Ü–∏—è–º
                </a>
                <a href="/import" class="btn btn-success">
                    <i class="fas fa-file-import"></i> –ò–º–ø–æ—Ä—Ç –Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
                </a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
        setTimeout(() => location.reload(), 600000);
        
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
        document.addEventListener('DOMContentLoaded', function() {
            const currentPath = window.location.pathname;
            document.querySelectorAll('.nav-link').forEach(link => {
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
