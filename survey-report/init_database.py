#!/usr/bin/env python3
import sqlite3
import sys

def init_db():
    """–°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç"""
    conn = sqlite3.connect('/var/www/survey-report/survey_complete.db')
    cursor = conn.cursor()
    
    # –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –ª–æ–∫–∞—Ü–∏–π
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS locations (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            name TEXT NOT NULL,
            category TEXT,
            responses INTEGER DEFAULT 0,
            satisfaction REAL DEFAULT 0.0,
            problems TEXT,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ''')
    
    # –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS questions (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            question_text TEXT NOT NULL,
            category TEXT,
            total_responses INTEGER DEFAULT 0,
            positive_responses INTEGER DEFAULT 0,
            neutral_responses INTEGER DEFAULT 0,
            negative_responses INTEGER DEFAULT 0,
            satisfaction_percent REAL DEFAULT 0.0,
            location TEXT,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ''')
    
    # –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –∑–∞–¥–∞—á
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS tasks (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            task_key TEXT NOT NULL,
            summary TEXT,
            status TEXT,
            category TEXT,
            location TEXT,
            priority INTEGER DEFAULT 3,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ''')
    
    conn.commit()
    print("‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã")
    return conn, cursor

def add_initial_data():
    """–î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"""
    conn, cursor = init_db()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ –ª–æ–∫–∞—Ü–∏–π
    cursor.execute("SELECT COUNT(*) FROM locations")
    if cursor.fetchone()[0] == 0:
        # –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–º–µ—Ä—ã –ª–æ–∫–∞—Ü–∏–π
        locations = [
            ('–ú–æ—Å–∫–æ–≤—Å–∫–∏–π –æ—Ñ–∏—Å', 'office', 55, 6.5, '–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤, –°—Ç–∞—Ä—ã–µ –º–æ–Ω–∏—Ç–æ—Ä—ã'),
            ('–î–æ–º–∞—à–Ω–∏–π –æ—Ñ–∏—Å', 'home', 25, 7.0, '–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é, VPN –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ'),
            ('–ó–∞–≤–æ–¥ –ù–æ–≥–∏–Ω—Å–∫', 'factory', 45, 7.8, '1–° –∑–∞–≤–∏—Å–∞–µ—Ç, –°—Ç–∞—Ä–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ'),
            ('–ó–∞–≤–æ–¥ –≠–Ω–≥–µ–ª—å—Å', 'factory', 38, 7.6, '–°–µ—Ç–µ–≤—ã–µ –¥–∏—Å–∫–∏, –ú–µ–¥–ª–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç'),
            ('–ó–∞–≤–æ–¥ –¢–æ—Å–Ω–æ', 'factory', 52, 6.8, '–ü—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, Excel —Ç–æ—Ä–º–æ–∑–∏—Ç'),
            ('–ó–∞–≤–æ–¥ –ü–µ—Ä–º—å', 'factory', 41, 6.5, '–ù–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ IT, –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–µ—á–∞—Ç—å—é'),
            ('–ó–∞–≤–æ–¥ –ö–æ–ª–æ–º–Ω–∞', 'factory', 33, 7.3, 'Excel –∑–∞–≤–∏—Å–∞–µ—Ç, –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã'),
            ('–ó–∞–≤–æ–¥ –°—Ç–∞–≤—Ä–æ–ø–æ–ª—å', 'factory', 28, 8.0, '–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–µ—á–∞—Ç—å—é, –ö–∞—á–µ—Å—Ç–≤–æ –º–æ–Ω–∏—Ç–æ—Ä–æ–≤'),
            ('–¢–æ—Ä–≥–æ–≤—ã–π –æ—Ñ–∏—Å', 'office', 5, 7.0, '–ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –º–æ–Ω–∏—Ç–æ—Ä–æ–≤, –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã'),
            ('–°–∫–ª–∞–¥ –ú–æ—Å–∫–≤–∞', 'warehouse', 12, 6.2, '–°—Ç–∞—Ä—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã, –ù–µ—Ç Wi-Fi')
        ]
        
        for loc in locations:
            cursor.execute('''
                INSERT INTO locations (name, category, responses, satisfaction, problems)
                VALUES (?, ?, ?, ?, ?)
            ''', loc)
        
        print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ {len(locations)} –ª–æ–∫–∞—Ü–∏–π")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–¥–∞—á–∏
    cursor.execute("SELECT COUNT(*) FROM tasks")
    if cursor.fetchone()[0] == 0:
        # –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏
        initial_tasks = [
            ('ITPROD-625', '–û–±–Ω–æ–≤–∏—Ç—å –°–ë–ò–° Saby –¥–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏', '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ', '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ü–û', '–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏', 2),
            ('ITPROD-610', '–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ë–∏—Ç—Ä–∏–∫—Å 24 –≤ –¶–ü–û', '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ', '–ù–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã', '–í—Å–µ –æ—Ñ–∏—Å—ã', 2),
            ('ITPROD-613', '–û–±–Ω–æ–≤–∏—Ç—å –Ø–Ω–¥–µ–∫—Å –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –¥–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏', '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ', '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ü–û', '–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏', 2),
            ('ITPROD-605', '–î–æ–±–∞–≤–∏—Ç—å –ø–∞–∫–µ—Ç –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ PDF –≤ –¶–ü–û', '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ', '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å', '–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏', 3),
            ('ITPROD-589', '–°–±–æ—Ä–∫–∞ —ç—Ç–∞–ª–æ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ Windows 11', '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ', '–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞', '–í—Å–µ –∑–∞–≤–æ–¥—ã', 3),
            ('ITPROD-576', '–û–±–Ω–æ–≤–∏—Ç—å Cisco Jabber –¥–æ 15.1', '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ', '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ü–û', '–í—Å–µ –æ—Ñ–∏—Å—ã', 2),
            ('ITPROD-534', '–û–±–Ω–æ–≤–∏—Ç—å VLC media player', '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ', '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ü–û', '–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏', 1),
            ('ITPROD-531', '–û–±–Ω–æ–≤–∏—Ç—å Adobe Acrobat', '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ', '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ü–û', '–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏', 2),
            ('ITPROD-529', '–û–±–Ω–æ–≤–∏—Ç—å –Ø–Ω–¥–µ–∫—Å –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä', '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ', '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ü–û', '–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏', 2),
            ('ITPROD-526', '–û–±–Ω–æ–≤–∏—Ç—å NanoCAD –¥–æ 25-–π –≤–µ—Ä—Å–∏–∏', '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ', '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ü–û', '–ó–∞–≤–æ–¥—ã', 3)
        ]
        
        for task in initial_tasks:
            cursor.execute('''
                INSERT INTO tasks (task_key, summary, status, category, location, priority)
                VALUES (?, ?, ?, ?, ?, ?)
            ''', task)
        
        print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ {len(initial_tasks)} –∑–∞–¥–∞—á")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–ø—Ä–æ—Å—ã
    cursor.execute("SELECT COUNT(*) FROM questions")
    if cursor.fetchone()[0] == 0:
        # –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
        standard_questions = [
            ('–ù–∞ —Å–∫–æ–ª—å–∫–æ –≤—ã —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏ —Å–µ–º–µ–π—Å—Ç–≤–∞ –Ø–Ω–¥–µ–∫—Å?', '–ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ', 115, 85, 15, 15, 73.9, '–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏'),
            ('–ù–∞ —Å–∫–æ–ª—å–∫–æ –≤—ã —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω—ã —Ä–∞–±–æ—Ç–æ–π –ø–∞–∫–µ—Ç–æ–≤ MS Office?', '–ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ', 115, 78, 12, 25, 67.8, '–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏'),
            ('–ö–∞–∫ –≤—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è 1–°?', '–ë–∏–∑–Ω–µ—Å-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è', 115, 62, 16, 37, 53.9, '–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏'),
            ('–ö–∞–∫ –≤—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Bitrix24?', '–ë–∏–∑–Ω–µ—Å-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è', 115, 40, 20, 55, 34.8, '–û—Ñ–∏—Å—ã'),
            ('–û—Ü–µ–Ω–∏—Ç–µ –ø–∞–∫–µ—Ç —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (–ö—Ä–∏–ø—Ç–æ –ü–†–û, –Ω–∞–Ω–¥–æ –ö–ê–î, PDF Editor...)', '–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è', 115, 52, 18, 45, 45.2, '–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏'),
            ('–û—Ü–µ–Ω–∏—Ç–µ —á–∞—Å—Ç–æ—Ç—É –∏ —É–¥–æ–±—Å—Ç–≤–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ü–û –∏ –û–°', '–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ', 115, 68, 22, 25, 59.1, '–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏'),
            ('–ù–∞ —Å–∫–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤–∞—à–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ—Å—Ç–Ω—ã—Ö –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π?', '–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å', 115, 58, 27, 30, 50.4, '–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏'),
            ('–û–±—â–∞—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞', '–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞', 115, 72, 25, 18, 62.6, '–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏')
        ]
        
        for q in standard_questions:
            cursor.execute('''
                INSERT INTO questions (question_text, category, total_responses, 
                                     positive_responses, neutral_responses, negative_responses, 
                                     satisfaction_percent, location)
                VALUES (?, ?, ?, ?, ?, ?, ?, ?)
            ''', q)
        
        print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ {len(standard_questions)} –≤–æ–ø—Ä–æ—Å–æ–≤")
    
    conn.commit()
    conn.close()
    
    print("\n‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!")
    print("üìä –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É:")
    print("   ‚Ä¢ URL: http://localhost:5004")
    print("   ‚Ä¢ –õ–æ–∫–∞—Ü–∏–∏: http://localhost:5004/locations")
    print("   ‚Ä¢ –í–æ–ø—Ä–æ—Å—ã: http://localhost:5004/questions")
    print("   ‚Ä¢ –ó–∞–¥–∞—á–∏: http://localhost:5004/tasks")
    print("   ‚Ä¢ –ò–º–ø–æ—Ä—Ç: http://localhost:5004/import")

if __name__ == '__main__':
    print("üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")
    add_initial_data()
